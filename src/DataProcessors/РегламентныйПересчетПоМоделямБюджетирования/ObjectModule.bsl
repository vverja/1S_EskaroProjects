// Настройка периода
Перем НП Экспорт;

#Если Клиент Тогда

// Выполняет перерасчет и перепроведение документов "РасчетПоМоделиБюджетирования",
// удовлетворяющих критериям, заданным в реквизитах обработки, для которых
// флаг "Пересчитывать регламентно" установлен в положение "Истина"
// 
//
Процедура ВыполнитьПересчетПоМоделям() Экспорт
	
	Если НЕ РучнойВыборДокументов Тогда
		
		Запрос=Новый Запрос;
		Запрос.Текст="ВЫБРАТЬ
		|	РасчетПоМоделиБюджетирования.Ссылка КАК ДокументРасчет
		|ИЗ
		|	Документ.РасчетПоМоделиБюджетирования КАК РасчетПоМоделиБюджетирования
		|
		|ГДЕ
		|	РасчетПоМоделиБюджетирования.ДатаРасчета МЕЖДУ &ДатаНач И &ДатаКон И
		|	РасчетПоМоделиБюджетирования.Сценарий = &Сценарий И
		|	(РасчетПоМоделиБюджетирования.ПересчитыватьРегламентно = ИСТИНА) И
		|	РасчетПоМоделиБюджетирования.Проведен = Истина";
		
		Запрос.УстановитьПараметр("ДатаНач",ДатаНач);
		Запрос.УстановитьПараметр("ДатаКон",КонецДня(ДатаКон));
		Запрос.УстановитьПараметр("Сценарий",Сценарий);
		
		Результат=Запрос.Выполнить().Выбрать();
		
		Попытка
			
			НачатьТранзакцию();
			
			Пока Результат.Следующий() Цикл
				
				ДокументРасчет=Результат.ДокументРасчет.ПолучитьОбъект();
				Сообщить(ОбщегоНазначения.ПредставлениеДокументаПриПроведении(ДокументРасчет));
				
				ДокументРасчет.ВыполнитьРасчет();
				ДокументРасчет.Записать(РежимЗаписиДокумента.Проведение);
				
			КонецЦикла;
			
			ЗафиксироватьТранзакцию();
			
		Исключение
			
			ОбщегоНазначения.СообщитьОбОшибке(ОписаниеОшибки(),, ("Не удалось провести документ " + Строка(ДокументРасчет)));
			
		КонецПопытки
		
	Иначе
		
		Попытка
			
			НачатьТранзакцию();
			
			Для Каждого Документ ИЗ ДокументыДляОбработки Цикл
				
				ДокументРасчет=Документ.РасчетПоМоделиБюджетирования.ПолучитьОбъект();
				Сообщить(ОбщегоНазначения.ПредставлениеДокументаПриПроведении(ДокументРасчет));
				
				ДокументРасчет.ВыполнитьРасчет();
				ДокументРасчет.Записать(РежимЗаписиДокумента.Проведение);
				
			КонецЦикла;
			
			ЗафиксироватьТранзакцию();
			
		Исключение
			
			ОбщегоНазначения.СообщитьОбОшибке(ОписаниеОшибки(),, ("Не удалось провести документ " + Строка(ДокументРасчет)));
			
		КонецПопытки
		
	КонецЕсли;
			
КонецПроцедуры // ВыполнитьПересчетПоМоделям()

НП = Новый НастройкаПериода;

#КонецЕсли
 