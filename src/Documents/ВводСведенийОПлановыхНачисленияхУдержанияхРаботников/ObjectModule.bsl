Перем мСписокНедоступныхРасчетов;
Перем мДлинаСуток;

// Заполняет начисления и удержания по схемам мотивации
// Параметры:
//   ВидТаблицы - Имя табличной части, в которую заполняются схемы мотивации
//   ТабличнаяЧасть - заполняемая табличная часть (без заменяемых записей)
// 	 Период - дата, на которую производится заполнение, по умолчанию - рабочая
//   Запрос - запрос, в менеджере временных таблиц которого присутствует таблица 
// 		ВТСписокРаботников с полями Сотрудник и Физлицо соответствующих типов
//	 ПоСхемамМотивации	- режим заполнения ТЧ, влияет на значение колонки "Действия" табличной части
//				
Процедура ЗаполнениеПоСхемамМотивации(ВидТаблицы = "Начисления", ТабличнаяЧасть = Неопределено, Период = '00010101', Запрос = Неопределено, ПоСхемамМотивации = Истина) Экспорт
	
	Если ТабличнаяЧасть = Неопределено Или Запрос = Неопределено Тогда
		Возврат
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Период) Тогда
		Период = ОбщегоНазначения.ПолучитьРабочуюДату();
	КонецЕсли;

	Если ВидТаблицы = "Начисления" Тогда
		ТекстЗапросаПоСхемамМотивации =
		"ВЫБРАТЬ
		|	НачисленияПоСхемамМотивации.Показатель1,
		|	НачисленияПоСхемамМотивации.Валюта1,
		|	НачисленияПоСхемамМотивации.Показатель2,
		|	НачисленияПоСхемамМотивации.Валюта2,
		|	НачисленияПоСхемамМотивации.Показатель3,
		|	НачисленияПоСхемамМотивации.Валюта3,
		|	НачисленияПоСхемамМотивации.Показатель4,
		|	НачисленияПоСхемамМотивации.Валюта4,
		|	НачисленияПоСхемамМотивации.Показатель5,
		|	НачисленияПоСхемамМотивации.Валюта5,
		|	НачисленияПоСхемамМотивации.Показатель6,
		|	НачисленияПоСхемамМотивации.Валюта6,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд1,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд2,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд3,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд4,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд5,
		|	НачисленияПоСхемамМотивации.ТарифныйРазряд6,
		|	НачисленияПоСхемамМотивации.Физлицо КАК Физлицо,
		|	НачисленияПоСхемамМотивации.ВидРасчета КАК ВидРасчета,
		|	Сотрудники.Сотрудник,
		|	&Период КАК ДатаДействия,
		|	ВЫБОР
		|		КОГДА &ЗаполнятьПоСхемамМотивации
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.НеИзменять)
		|		КОГДА НачисленияПоСхемамМотивации.СМВидРасчета ЕСТЬ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|		КОГДА НачисленияПоСхемамМотивации.ПНВидРасчета ЕСТЬ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Начать)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Изменить)
		|	КОНЕЦ КАК Действие
		|ИЗ
		|	ВТСписокРаботников КАК Сотрудники
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			Начисления.Физлицо КАК Физлицо,
		|			Начисления.ВидРасчета КАК ВидРасчета,
		|			МАКСИМУМ(Начисления.ПНВидРасчета) КАК ПНВидРасчета,
		|			МАКСИМУМ(Начисления.СМВидРасчета) КАК СМВидРасчета,
		|			МАКСИМУМ(Начисления.Показатель1) КАК Показатель1,
		|			МАКСИМУМ(Начисления.Валюта1) КАК Валюта1,
		|			МАКСИМУМ(Начисления.Показатель2) КАК Показатель2,
		|			МАКСИМУМ(Начисления.Валюта2) КАК Валюта2,
		|			МАКСИМУМ(Начисления.Показатель3) КАК Показатель3,
		|			МАКСИМУМ(Начисления.Валюта3) КАК Валюта3,
		|			МАКСИМУМ(Начисления.Показатель4) КАК Показатель4,
		|			МАКСИМУМ(Начисления.Валюта4) КАК Валюта4,
		|			МАКСИМУМ(Начисления.Показатель5) КАК Показатель5,
		|			МАКСИМУМ(Начисления.Валюта5) КАК Валюта5,
		|			МАКСИМУМ(Начисления.Показатель6) КАК Показатель6,
		|			МАКСИМУМ(Начисления.Валюта6) КАК Валюта6,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд1) КАК ТарифныйРазряд1,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд2) КАК ТарифныйРазряд2,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд3) КАК ТарифныйРазряд3,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд4) КАК ТарифныйРазряд4,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд5) КАК ТарифныйРазряд5,
		|			МАКСИМУМ(Начисления.ТарифныйРазряд6) КАК ТарифныйРазряд6
		|		ИЗ
		|			(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				ПлановыеВРРаботниковСрезПоследних.ФизЛицо КАК Физлицо,
		|				ВЫБОР
		|					КОГДА ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <= &Период
		|							И ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|						ТОГДА ПлановыеВРРаботниковСрезПоследних.ВидРасчетаЗавершения
		|					ИНАЧЕ ПлановыеВРРаботниковСрезПоследних.ВидРасчета
		|				КОНЕЦ КАК ВидРасчета,
		|				ВЫБОР
		|					КОГДА ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <= &Период
		|							И ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|						ТОГДА ПлановыеВРРаботниковСрезПоследних.ВидРасчетаЗавершения
		|					ИНАЧЕ ПлановыеВРРаботниковСрезПоследних.ВидРасчета
		|				КОНЕЦ КАК ПНВидРасчета,
		|				NULL КАК СМВидРасчета,
		|				NULL КАК Показатель1,
		|				NULL КАК Валюта1,
		|				NULL КАК Показатель2,
		|				NULL КАК Валюта2,
		|				NULL КАК Показатель3,
		|				NULL КАК Валюта3,
		|				NULL КАК Показатель4,
		|				NULL КАК Валюта4,
		|				NULL КАК Показатель5,
		|				NULL КАК Валюта5,
		|				NULL КАК Показатель6,
		|				NULL КАК Валюта6,
		|				NULL КАК ТарифныйРазряд1,
		|				NULL КАК ТарифныйРазряд2,
		|				NULL КАК ТарифныйРазряд3,
		|				NULL КАК ТарифныйРазряд4,
		|				NULL КАК ТарифныйРазряд5,
		|				NULL КАК ТарифныйРазряд6
		|			ИЗ
		|				РегистрСведений.ПлановыеНачисленияРаботников.СрезПоследних(
		|						&Период,
		|						Физлицо В
		|							(ВЫБРАТЬ
		|								Физлица.Физлицо
		|							ИЗ
		|								ВТСписокРаботников КАК Физлица)) КАК ПлановыеВРРаботниковСрезПоследних
		|			ГДЕ
		|				ВЫБОР
		|						КОГДА ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <= &Период
		|								И ПлановыеВРРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							ТОГДА ПлановыеВРРаботниковСрезПоследних.ДействиеЗавершения
		|						ИНАЧЕ ПлановыеВРРаботниковСрезПоследних.Действие
		|					КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|			
		|			ОБЪЕДИНИТЬ
		|			
		|			ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				РаботникиСрезПоследних.ФизЛицо,
		|				СхемыМотивации.ВидРасчета,
		|				NULL,
		|				СхемыМотивации.ВидРасчета,
		|				СхемыМотивации.Показатель1,
		|				СхемыМотивации.Валюта1,
		|				СхемыМотивации.Показатель2,
		|				СхемыМотивации.Валюта2,
		|				СхемыМотивации.Показатель3,
		|				СхемыМотивации.Валюта3,
		|				СхемыМотивации.Показатель4,
		|				СхемыМотивации.Валюта4,
		|				СхемыМотивации.Показатель5,
		|				СхемыМотивации.Валюта5,
		|				СхемыМотивации.Показатель6,
		|				СхемыМотивации.Валюта6,
		|				СхемыМотивации.ТарифныйРазряд1,
		|				СхемыМотивации.ТарифныйРазряд2,
		|				СхемыМотивации.ТарифныйРазряд3,
		|				СхемыМотивации.ТарифныйРазряд4,
		|				СхемыМотивации.ТарифныйРазряд5,
		|				СхемыМотивации.ТарифныйРазряд6
		|			ИЗ
		|				РегистрСведений.Работники.СрезПоследних(
		|						&Период,
		|						Физлицо В
		|							(ВЫБРАТЬ
		|								Физлица.Физлицо
		|							ИЗ
		|								ВТСписокРаботников КАК Физлица)) КАК РаботникиСрезПоследних
		|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		|						СхемыМотивацииРаботников.ВидРасчета КАК ВидРасчета,
		|						СхемыМотивацииРаботников.Показатель1 КАК Показатель1,
		|						СхемыМотивацииРаботников.Валюта1 КАК Валюта1,
		|						СхемыМотивацииРаботников.Показатель2 КАК Показатель2,
		|						СхемыМотивацииРаботников.Валюта2 КАК Валюта2,
		|						СхемыМотивацииРаботников.Показатель3 КАК Показатель3,
		|						СхемыМотивацииРаботников.Валюта3 КАК Валюта3,
		|						СхемыМотивацииРаботников.Показатель4 КАК Показатель4,
		|						СхемыМотивацииРаботников.Валюта4 КАК Валюта4,
		|						СхемыМотивацииРаботников.Показатель5 КАК Показатель5,
		|						СхемыМотивацииРаботников.Валюта5 КАК Валюта5,
		|						СхемыМотивацииРаботников.Показатель6 КАК Показатель6,
		|						СхемыМотивацииРаботников.Валюта6 КАК Валюта6,
		|						СхемыМотивацииРаботников.Подразделение КАК Подразделение,
		|						СхемыМотивацииРаботников.Должность КАК Должность,
		|						СхемыМотивацииРаботников.ТарифныйРазряд1 КАК ТарифныйРазряд1,
		|						СхемыМотивацииРаботников.ТарифныйРазряд2 КАК ТарифныйРазряд2,
		|						СхемыМотивацииРаботников.ТарифныйРазряд3 КАК ТарифныйРазряд3,
		|						СхемыМотивацииРаботников.ТарифныйРазряд4 КАК ТарифныйРазряд4,
		|						СхемыМотивацииРаботников.ТарифныйРазряд5 КАК ТарифныйРазряд5,
		|						СхемыМотивацииРаботников.ТарифныйРазряд6 КАК ТарифныйРазряд6
		|					ИЗ
		|						РегистрСведений.СхемыМотивацииРаботников КАК СхемыМотивацииРаботников
		|					ГДЕ
		|						СхемыМотивацииРаботников.ВидРасчета ССЫЛКА ПланВидовРасчета.УправленческиеНачисления) КАК СхемыМотивации
		|					ПО (ВЫБОР
		|							КОГДА СхемыМотивации.Должность <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка)
		|									И СхемыМотивации.Подразделение <> НЕОПРЕДЕЛЕНО
		|								ТОГДА РаботникиСрезПоследних.Должность = СхемыМотивации.Должность
		|										И РаботникиСрезПоследних.Подразделение = СхемыМотивации.Подразделение
		|							ИНАЧЕ ВЫБОР
		|									КОГДА СхемыМотивации.Подразделение = НЕОПРЕДЕЛЕНО
		|										ТОГДА РаботникиСрезПоследних.Должность = СхемыМотивации.Должность
		|									ИНАЧЕ РаботникиСрезПоследних.Подразделение = СхемыМотивации.Подразделение
		|								КОНЕЦ
		|						КОНЕЦ)) КАК Начисления
		|		
		|		СГРУППИРОВАТЬ ПО
		|			Начисления.Физлицо,
		|			Начисления.ВидРасчета) КАК НачисленияПоСхемамМотивации
		|		ПО Сотрудники.Физлицо = НачисленияПоСхемамМотивации.Физлицо
		|
		|УПОРЯДОЧИТЬ ПО
		|	Физлицо,
		|	ВидРасчета";
		
	Иначе
		ТекстЗапросаПоСхемамМотивации = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	УдержанияПоСхемамМотивации.ФизЛицо КАК Физлицо,
		|	УдержанияПоСхемамМотивации.ВидРасчета КАК ВидРасчета,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель1) КАК Показатель1,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта1) КАК Валюта1,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель2) КАК Показатель2,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта2) КАК Валюта2,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель3) КАК Показатель3,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта3) КАК Валюта3,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель4) КАК Показатель4,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта4) КАК Валюта4,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель5) КАК Показатель5,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта5) КАК Валюта5,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Показатель6) КАК Показатель6,
		|	МАКСИМУМ(УдержанияПоСхемамМотивации.Валюта6) КАК Валюта6,
		|	&Период КАК ДатаДействия,
		|	ВЫБОР
		|		КОГДА &ЗаполнятьПоСхемамМотивации
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.НеИзменять)
		|		КОГДА МАКСИМУМ(УдержанияПоСхемамМотивации.СМВидРасчета) ЕСТЬ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|		КОГДА МАКСИМУМ(УдержанияПоСхемамМотивации.ПНВидРасчета) ЕСТЬ NULL 
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Начать)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Изменить)
		|	КОНЕЦ КАК Действие
		|ИЗ
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ПлановыеУдержанияРаботниковСрезПоследних.ФизЛицо КАК ФизЛицо,
		|		ПлановыеУдержанияРаботниковСрезПоследних.ВидРасчета КАК ВидРасчета,
		|		ПлановыеУдержанияРаботниковСрезПоследних.ВидРасчета КАК ПНВидРасчета,
		|		NULL КАК СМВидРасчета,
		|		NULL КАК Показатель1,
		|		NULL КАК Валюта1,
		|		NULL КАК Показатель2,
		|		NULL КАК Валюта2,
		|		NULL КАК Показатель3,
		|		NULL КАК Валюта3,
		|		NULL КАК Показатель4,
		|		NULL КАК Валюта4,
		|		NULL КАК Показатель5,
		|		NULL КАК Валюта5,
		|		NULL КАК Показатель6,
		|		NULL КАК Валюта6
		|	ИЗ
		|		РегистрСведений.ПлановыеУдержанияРаботников.СрезПоследних(
		|				&Период,
		|				Физлицо В
		|					(ВЫБРАТЬ
		|						Физлица.Физлицо
		|					ИЗ
		|						ВТСписокРаботников КАК Физлица)) КАК ПлановыеУдержанияРаботниковСрезПоследних
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &Период
		|						И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|					ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.ДействиеЗавершения
		|				ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Действие
		|			КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|	
		|	ОБЪЕДИНИТЬ
		|	
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		РаботникиСрезПоследних.ФизЛицо,
		|		СхемыМотивации.ВидРасчета,
		|		NULL,
		|		СхемыМотивации.ВидРасчета,
		|		СхемыМотивации.Показатель1,
		|		СхемыМотивации.Валюта1,
		|		СхемыМотивации.Показатель2,
		|		СхемыМотивации.Валюта2,
		|		СхемыМотивации.Показатель3,
		|		СхемыМотивации.Валюта3,
		|		СхемыМотивации.Показатель4,
		|		СхемыМотивации.Валюта4,
		|		СхемыМотивации.Показатель5,
		|		СхемыМотивации.Валюта5,
		|		СхемыМотивации.Показатель6,
		|		СхемыМотивации.Валюта6
		|	ИЗ
		|		РегистрСведений.Работники.СрезПоследних(
		|				&Период,
		|				Физлицо В
		|					(ВЫБРАТЬ
		|						Физлица.Физлицо
		|					ИЗ
		|						ВТСписокРаботников КАК Физлица)) КАК РаботникиСрезПоследних
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				СхемыМотивацииРаботников.ВидРасчета КАК ВидРасчета,
		|				СхемыМотивацииРаботников.Показатель1 КАК Показатель1,
		|				СхемыМотивацииРаботников.Валюта1 КАК Валюта1,
		|				СхемыМотивацииРаботников.Показатель2 КАК Показатель2,
		|				СхемыМотивацииРаботников.Валюта2 КАК Валюта2,
		|				СхемыМотивацииРаботников.Показатель3 КАК Показатель3,
		|				СхемыМотивацииРаботников.Валюта3 КАК Валюта3,
		|				СхемыМотивацииРаботников.Показатель4 КАК Показатель4,
		|				СхемыМотивацииРаботников.Валюта4 КАК Валюта4,
		|				СхемыМотивацииРаботников.Показатель5 КАК Показатель5,
		|				СхемыМотивацииРаботников.Валюта5 КАК Валюта5,
		|				СхемыМотивацииРаботников.Показатель6 КАК Показатель6,
		|				СхемыМотивацииРаботников.Валюта6 КАК Валюта6,
		|				СхемыМотивацииРаботников.Подразделение КАК Подразделение,
		|				СхемыМотивацииРаботников.Должность КАК Должность
		|			ИЗ
		|				РегистрСведений.СхемыМотивацииРаботников КАК СхемыМотивацииРаботников
		|			ГДЕ
		|				СхемыМотивацииРаботников.ВидРасчета ССЫЛКА ПланВидовРасчета.УправленческиеУдержания) КАК СхемыМотивации
		|			ПО (ВЫБОР
		|					КОГДА СхемыМотивации.Должность <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка)
		|							И СхемыМотивации.Подразделение <> НЕОПРЕДЕЛЕНО
		|						ТОГДА РаботникиСрезПоследних.Должность = СхемыМотивации.Должность
		|								И РаботникиСрезПоследних.Подразделение = СхемыМотивации.Подразделение
		|					ИНАЧЕ ВЫБОР
		|							КОГДА СхемыМотивации.Подразделение = НЕОПРЕДЕЛЕНО
		|								ТОГДА РаботникиСрезПоследних.Должность = СхемыМотивации.Должность
		|							ИНАЧЕ РаботникиСрезПоследних.Подразделение = СхемыМотивации.Подразделение
		|						КОНЕЦ
		|				КОНЕЦ)) КАК УдержанияПоСхемамМотивации
		|
		|СГРУППИРОВАТЬ ПО
		|	УдержанияПоСхемамМотивации.ФизЛицо,
		|	УдержанияПоСхемамМотивации.ВидРасчета
		|
		|УПОРЯДОЧИТЬ ПО
		|	Физлицо,
		|	ВидРасчета";
		
	КонецЕсли;
	
	ЗапросПоСхемамМотивации = Запрос;
	ЗапросПоСхемамМотивации.Текст = ТекстЗапросаПоСхемамМотивации;
	ЗапросПоСхемамМотивации.УстановитьПараметр("Период", Период);
	ЗапросПоСхемамМотивации.УстановитьПараметр("ЗаполнятьПоСхемамМотивации", ПоСхемамМотивации);
	
	Выборка = ЗапросПоСхемамМотивации.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ЗаполнитьЗначенияСвойств(ТабличнаяЧасть.Добавить(),Выборка);
	КонецЦикла;

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Формирует запрос по таблице "Начисления" и таблице "Удержания" документа
//
// Параметры: 
//  нет
//
// Возвращаемое значение:
//  Результат запроса.
//
Функция СформироватьЗапрос()

	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("парамСсылка", Ссылка);
	Запрос.УстановитьПараметр("ПустаяСсылка", Документы.ВводСведенийОПлановыхНачисленияхУдержанияхРаботников.ПустаяСсылка());
	
	МенеджерВТ = Новый МенеджерВременныхТаблиц;
	Запрос.МенеджерВременныхТаблиц = МенеджерВТ;	
	
	// получим временную таблицу с показателями начислений
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Начисления.ВидРасчета КАК ВидРасчета,
	|	МАКСИМУМ(Показатели.НомерСтроки) КАК КоличествоПоказателей,
	|	Показатели1.Показатель.Предопределенный КАК Показатель1Предопределенный,
	|	Показатели1.Показатель.Наименование КАК Показатель1Наименование,
	|	Показатели1.Показатель.ТипПоказателя КАК Показатель1ТипПоказателя,
	|	Показатели1.Показатель.ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
	|	Показатели2.Показатель.Предопределенный КАК Показатель2Предопределенный,
	|	Показатели2.Показатель.Наименование КАК Показатель2Наименование,
	|	Показатели2.Показатель.ТипПоказателя КАК Показатель2ТипПоказателя,
	|	Показатели2.Показатель.ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
	|	Показатели3.Показатель.Предопределенный КАК Показатель3Предопределенный,
	|	Показатели3.Показатель.Наименование КАК Показатель3Наименование,
	|	Показатели3.Показатель.ТипПоказателя КАК Показатель3ТипПоказателя,
	|	Показатели3.Показатель.ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
	|	Показатели4.Показатель.Предопределенный КАК Показатель4Предопределенный,
	|	Показатели4.Показатель.Наименование КАК Показатель4Наименование,
	|	Показатели4.Показатель.ТипПоказателя КАК Показатель4ТипПоказателя,
	|	Показатели4.Показатель.ВозможностьИзменения КАК Показатель4ВозможностьИзменения,
	|	Показатели5.Показатель.Предопределенный КАК Показатель5Предопределенный,
	|	Показатели5.Показатель.Наименование КАК Показатель5Наименование,
	|	Показатели5.Показатель.ТипПоказателя КАК Показатель5ТипПоказателя,
	|	Показатели5.Показатель.ВозможностьИзменения КАК Показатель5ВозможностьИзменения,
	|	Показатели6.Показатель.Предопределенный КАК Показатель6Предопределенный,
	|	Показатели6.Показатель.Наименование КАК Показатель6Наименование,
	|	Показатели6.Показатель.ТипПоказателя КАК Показатель6ТипПоказателя,
	|	Показатели6.Показатель.ВозможностьИзменения КАК Показатель6ВозможностьИзменения,
	|	Показатели1.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели2.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели3.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели4.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели5.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели6.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели1.Показатель.ТарифнаяСтавка КАК Показатель1ТарифнаяСтавка,
	|	Показатели2.Показатель.ТарифнаяСтавка КАК Показатель2ТарифнаяСтавка,
	|	Показатели3.Показатель.ТарифнаяСтавка КАК Показатель3ТарифнаяСтавка,
	|	Показатели4.Показатель.ТарифнаяСтавка КАК Показатель4ТарифнаяСтавка,
	|	Показатели5.Показатель.ТарифнаяСтавка КАК Показатель5ТарифнаяСтавка,
	|	Показатели6.Показатель.ТарифнаяСтавка КАК Показатель6ТарифнаяСтавка
	|ПОМЕСТИТЬ ВТПоказателиНачислений
	|ИЗ
	|	Документ.ВводСведенийОПлановыхНачисленияхУдержанияхРаботников.Начисления КАК Начисления
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели
	|		ПО Начисления.ВидРасчета = Показатели.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели1
	|		ПО Начисления.ВидРасчета = Показатели1.Ссылка
	|			И (Показатели1.НомерСтроки = 1)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели2
	|		ПО Начисления.ВидРасчета = Показатели2.Ссылка
	|			И (Показатели2.НомерСтроки = 2)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели3
	|		ПО Начисления.ВидРасчета = Показатели3.Ссылка
	|			И (Показатели3.НомерСтроки = 3)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели4
	|		ПО Начисления.ВидРасчета = Показатели4.Ссылка
	|			И (Показатели4.НомерСтроки = 4)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели5
	|		ПО Начисления.ВидРасчета = Показатели5.Ссылка
	|			И (Показатели5.НомерСтроки = 5)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеНачисления.Показатели КАК Показатели6
	|		ПО Начисления.ВидРасчета = Показатели6.Ссылка
	|			И (Показатели6.НомерСтроки = 6)
	|ГДЕ
	|	Начисления.Ссылка = &парамСсылка
	|
	|СГРУППИРОВАТЬ ПО
	|	Начисления.ВидРасчета,
	|	Показатели1.Показатель,
	|	Показатели2.Показатель,
	|	Показатели3.Показатель,
	|	Показатели4.Показатель,
	|	Показатели5.Показатель,
	|	Показатели6.Показатель,
	|	Показатели1.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели2.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели3.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели4.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели5.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели6.ЗапрашиватьПриКадровыхПеремещениях
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ВидРасчета";		

	Запрос.Выполнить();	
	
	// получим временную таблицу с показателями начислений
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Удержания.ВидРасчета КАК ВидРасчета,
	|	МАКСИМУМ(Показатели.НомерСтроки) КАК КоличествоПоказателей,
	|	Показатели1.Показатель.Предопределенный КАК Показатель1Предопределенный,
	|	Показатели1.Показатель.Наименование КАК Показатель1Наименование,
	|	Показатели1.Показатель.ТипПоказателя КАК Показатель1ТипПоказателя,
	|	Показатели1.Показатель.ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
	|	Показатели2.Показатель.Предопределенный КАК Показатель2Предопределенный,
	|	Показатели2.Показатель.Наименование КАК Показатель2Наименование,
	|	Показатели2.Показатель.ТипПоказателя КАК Показатель2ТипПоказателя,
	|	Показатели2.Показатель.ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
	|	Показатели3.Показатель.Предопределенный КАК Показатель3Предопределенный,
	|	Показатели3.Показатель.Наименование КАК Показатель3Наименование,
	|	Показатели3.Показатель.ТипПоказателя КАК Показатель3ТипПоказателя,
	|	Показатели3.Показатель.ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
	|	Показатели4.Показатель.Предопределенный КАК Показатель4Предопределенный,
	|	Показатели4.Показатель.Наименование КАК Показатель4Наименование,
	|	Показатели4.Показатель.ТипПоказателя КАК Показатель4ТипПоказателя,
	|	Показатели4.Показатель.ВозможностьИзменения КАК Показатель4ВозможностьИзменения,
	|	Показатели5.Показатель.Предопределенный КАК Показатель5Предопределенный,
	|	Показатели5.Показатель.Наименование КАК Показатель5Наименование,
	|	Показатели5.Показатель.ТипПоказателя КАК Показатель5ТипПоказателя,
	|	Показатели5.Показатель.ВозможностьИзменения КАК Показатель5ВозможностьИзменения,
	|	Показатели6.Показатель.Предопределенный КАК Показатель6Предопределенный,
	|	Показатели6.Показатель.Наименование КАК Показатель6Наименование,
	|	Показатели6.Показатель.ТипПоказателя КАК Показатель6ТипПоказателя,
	|	Показатели6.Показатель.ВозможностьИзменения КАК Показатель6ВозможностьИзменения,
	|	Показатели1.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели2.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели3.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели4.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели5.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели6.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели1.Показатель.ТарифнаяСтавка КАК Показатель1ТарифнаяСтавка,
	|	Показатели2.Показатель.ТарифнаяСтавка КАК Показатель2ТарифнаяСтавка,
	|	Показатели3.Показатель.ТарифнаяСтавка КАК Показатель3ТарифнаяСтавка,
	|	Показатели4.Показатель.ТарифнаяСтавка КАК Показатель4ТарифнаяСтавка,
	|	Показатели5.Показатель.ТарифнаяСтавка КАК Показатель5ТарифнаяСтавка,
	|	Показатели6.Показатель.ТарифнаяСтавка КАК Показатель6ТарифнаяСтавка
	|ПОМЕСТИТЬ ВТПоказателиУдержаний
	|ИЗ
	|	Документ.ВводСведенийОПлановыхНачисленияхУдержанияхРаботников.Удержания КАК Удержания
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели
	|		ПО Удержания.ВидРасчета = Показатели.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели1
	|		ПО Удержания.ВидРасчета = Показатели1.Ссылка
	|			И (Показатели1.НомерСтроки = 1)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели2
	|		ПО Удержания.ВидРасчета = Показатели2.Ссылка
	|			И (Показатели2.НомерСтроки = 2)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели3
	|		ПО Удержания.ВидРасчета = Показатели3.Ссылка
	|			И (Показатели3.НомерСтроки = 3)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели4
	|		ПО Удержания.ВидРасчета = Показатели4.Ссылка
	|			И (Показатели4.НомерСтроки = 4)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели5
	|		ПО Удержания.ВидРасчета = Показатели5.Ссылка
	|			И (Показатели5.НомерСтроки = 5)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УправленческиеУдержания.Показатели КАК Показатели6
	|		ПО Удержания.ВидРасчета = Показатели6.Ссылка
	|			И (Показатели6.НомерСтроки = 6)
	|ГДЕ
	|	Удержания.Ссылка = &парамСсылка
	|
	|СГРУППИРОВАТЬ ПО
	|	Удержания.ВидРасчета,
	|	Показатели1.Показатель,
	|	Показатели2.Показатель,
	|	Показатели3.Показатель,
	|	Показатели4.Показатель,
	|	Показатели5.Показатель,
	|	Показатели6.Показатель,
	|	Показатели1.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели2.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели3.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели4.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели5.ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели6.ЗапрашиватьПриКадровыхПеремещениях
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ВидРасчета";

	Запрос.Выполнить();	
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НачисленияРаботникам.НомерСтроки,
	|	НачисленияРаботникам.Сотрудник,
	|	НачисленияРаботникам.Сотрудник.Физлицо КАК Физлицо,
	|	ИСТИНА КАК ПроизвольнаяФормулаРасчета,
	|	НачисленияРаботникам.ВидРасчета.ЗачетОтработанногоВремени КАК ОсновноеНачисление,
	|	НачисленияРаботникам.ВидРасчета,
	|	НачисленияРаботникам.Действие,
	|	НачисленияРаботникам.Показатель1,
	|	НачисленияРаботникам.Валюта1,
	|	НачисленияРаботникам.Показатель2,
	|	НачисленияРаботникам.Валюта2,
	|	НачисленияРаботникам.Показатель3,
	|	НачисленияРаботникам.Валюта3,
	|	НачисленияРаботникам.Показатель4,
	|	НачисленияРаботникам.Валюта4,
	|	НачисленияРаботникам.Показатель5,
	|	НачисленияРаботникам.Валюта5,
	|	НачисленияРаботникам.Показатель6,
	|	НачисленияРаботникам.Валюта6,
	|	НачисленияРаботникам.ТарифныйРазряд1,
	|	НачисленияРаботникам.ТарифныйРазряд2,
	|	НачисленияРаботникам.ТарифныйРазряд3,
	|	НачисленияРаботникам.ТарифныйРазряд4,
	|	НачисленияРаботникам.ТарифныйРазряд5,
	|	НачисленияРаботникам.ТарифныйРазряд6,
	|	ЕСТЬNULL(Показатели.КоличествоПоказателей, 0) КАК КоличествоПоказателей,
	|	Показатели.Показатель1Предопределенный,
	|	Показатели.Показатель1Наименование,
	|	Показатели.Показатель1ТипПоказателя,
	|	Показатели.Показатель1ВозможностьИзменения,
	|	Показатели.Показатель2Предопределенный,
	|	Показатели.Показатель2Наименование,
	|	Показатели.Показатель2ТипПоказателя,
	|	Показатели.Показатель2ВозможностьИзменения,
	|	Показатели.Показатель3Предопределенный,
	|	Показатели.Показатель3Наименование,
	|	Показатели.Показатель3ТипПоказателя,
	|	Показатели.Показатель3ВозможностьИзменения,
	|	Показатели.Показатель4Предопределенный,
	|	Показатели.Показатель4Наименование,
	|	Показатели.Показатель4ТипПоказателя,
	|	Показатели.Показатель4ВозможностьИзменения,
	|	Показатели.Показатель5Предопределенный,
	|	Показатели.Показатель5Наименование,
	|	Показатели.Показатель5ТипПоказателя,
	|	Показатели.Показатель5ВозможностьИзменения,
	|	Показатели.Показатель6Предопределенный,
	|	Показатели.Показатель6Наименование,
	|	Показатели.Показатель6ТипПоказателя,
	|	Показатели.Показатель6ВозможностьИзменения,
	|	""Начисление"" КАК ТипТаблицы,
	|	НачисленияРаботникам.ДатаДействияКонец,
	|	НачисленияРаботникам.ДатаДействия,
	|	Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель1ТарифнаяСтавка,
	|	Показатели.Показатель2ТарифнаяСтавка,
	|	Показатели.Показатель3ТарифнаяСтавка,
	|	Показатели.Показатель4ТарифнаяСтавка,
	|	Показатели.Показатель5ТарифнаяСтавка,
	|	Показатели.Показатель6ТарифнаяСтавка
	|ИЗ
	|	Документ.ВводСведенийОПлановыхНачисленияхУдержанияхРаботников.Начисления КАК НачисленияРаботникам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиНачислений КАК Показатели
	|		ПО НачисленияРаботникам.ВидРасчета = Показатели.ВидРасчета
	|ГДЕ
	|	НачисленияРаботникам.Ссылка = &парамСсылка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	УдержанияРаботникам.НомерСтроки,
	|	NULL,
	|	УдержанияРаботникам.Физлицо,
	|	ИСТИНА,
	|	ИСТИНА,
	|	УдержанияРаботникам.ВидРасчета,
	|	УдержанияРаботникам.Действие,
	|	УдержанияРаботникам.Показатель1,
	|	УдержанияРаботникам.Валюта1,
	|	УдержанияРаботникам.Показатель2,
	|	УдержанияРаботникам.Валюта2,
	|	УдержанияРаботникам.Показатель3,
	|	УдержанияРаботникам.Валюта3,
	|	УдержанияРаботникам.Показатель4,
	|	УдержанияРаботникам.Валюта4,
	|	УдержанияРаботникам.Показатель5,
	|	УдержанияРаботникам.Валюта5,
	|	УдержанияРаботникам.Показатель6,
	|	УдержанияРаботникам.Валюта6,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	ЕСТЬNULL(Показатели.КоличествоПоказателей, 0),
	|	Показатели.Показатель1Предопределенный,
	|	Показатели.Показатель1Наименование,
	|	Показатели.Показатель1ТипПоказателя,
	|	Показатели.Показатель1ВозможностьИзменения,
	|	Показатели.Показатель2Предопределенный,
	|	Показатели.Показатель2Наименование,
	|	Показатели.Показатель2ТипПоказателя,
	|	Показатели.Показатель2ВозможностьИзменения,
	|	Показатели.Показатель3Предопределенный,
	|	Показатели.Показатель3Наименование,
	|	Показатели.Показатель3ТипПоказателя,
	|	Показатели.Показатель3ВозможностьИзменения,
	|	Показатели.Показатель4Предопределенный,
	|	Показатели.Показатель4Наименование,
	|	Показатели.Показатель4ТипПоказателя,
	|	Показатели.Показатель4ВозможностьИзменения,
	|	Показатели.Показатель5Предопределенный,
	|	Показатели.Показатель5Наименование,
	|	Показатели.Показатель5ТипПоказателя,
	|	Показатели.Показатель5ВозможностьИзменения,
	|	Показатели.Показатель6Предопределенный,
	|	Показатели.Показатель6Наименование,
	|	Показатели.Показатель6ТипПоказателя,
	|	Показатели.Показатель6ВозможностьИзменения,
	|	""Удержание"",
	|	УдержанияРаботникам.ДатаДействияКонец,
	|	УдержанияРаботникам.ДатаДействия,
	|	Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	|	Показатели.Показатель1ТарифнаяСтавка,
	|	Показатели.Показатель2ТарифнаяСтавка,
	|	Показатели.Показатель3ТарифнаяСтавка,
	|	Показатели.Показатель4ТарифнаяСтавка,
	|	Показатели.Показатель5ТарифнаяСтавка,
	|	Показатели.Показатель6ТарифнаяСтавка
	|ИЗ
	|	Документ.ВводСведенийОПлановыхНачисленияхУдержанияхРаботников.Удержания КАК УдержанияРаботникам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиУдержаний КАК Показатели
	|		ПО УдержанияРаботникам.ВидРасчета = Показатели.ВидРасчета
	|ГДЕ
	|	УдержанияРаботникам.Ссылка = &парамСсылка";
	
	Запрос.Текст = ТекстЗапроса;
	
	Возврат Запрос.Выполнить();

КонецФункции // СформироватьЗапрос

// Проверяет правильность заполнения реквизитов в строке ТЧ "Начисления" документа.
// Если какой-то из реквизтов, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по строке ТЧ документа,
//
// Параметры: 
//  ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
//  							  из результата запроса
//  Отказ 						- флаг отказа в проведении.
//	Заголовок				- Заголовок для сообщений об ошибках проведения
//
Процедура ПроверитьЗаполнениеСтроки(ВыборкаПоСтрокамДокумента, Отказ, Заголовок)

	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки) +
									""" табл. части "+?(ВыборкаПоСтрокамДокумента.ТипТаблицы = "Удержание", "Удержания", "Начисления")+": ";
	
	Если ВыборкаПоСтрокамДокумента.ТипТаблицы = "Начисление" Тогда
		// Сотрудник
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Сотрудник) Тогда
			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не выбран сотрудник!", Отказ, Заголовок);
		КонецЕсли;
		
	Иначе
		// ФизЛицо
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Физлицо) Тогда
			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не выбрано физическое лицо!", Отказ, Заголовок);
		КонецЕсли;
		
	КонецЕсли;
	
	// ВидРасчета
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ВидРасчета) И ВыборкаПоСтрокамДокумента.Действие <> Перечисления.ВидыДействияСНачислением.НеИзменять Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указано " + ?(ВыборкаПоСтрокамДокумента.ТипТаблицы = "Удержание", "удержание!", "начисление!"), Отказ, Заголовок);
		
	ИначеЕсли мСписокНедоступныхРасчетов.НайтиПоЗначению(ВыборкаПоСтрокамДокумента.ВидРасчета) <> Неопределено Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указанный вид расчета нельзя назначать в качестве планового!", Отказ, Заголовок);
		
	ИначеЕсли (ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.Начать или ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.Изменить) Тогда
		
		ПроведениеРасчетов.ПроверкаПоказателейВПлановыхНачислениях(ВыборкаПоСтрокамДокумента, СтрокаНачалаСообщенияОбОшибке, Ложь, Отказ, Заголовок, Истина);

	КонецЕсли;

	// Действие
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Действие) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указано действие!", Отказ, Заголовок);
	КонецЕсли;
	
	// ДатаДействия
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаДействия) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не задана дата действия!", Отказ, Заголовок);
	КонецЕсли;
	
	// Перид действия
	Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаДействияКонец) И ВыборкаПоСтрокамДокумента.ДатаДействия > ВыборкаПоСтрокамДокумента.ДатаДействияКонец Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата окончания действия не должна быть меньше даты начала!", Отказ, Заголовок);
	КонецЕсли; 
	
КонецПроцедуры // ПроверитьЗаполнениеСтроки()

// По строке выборки результата запроса по документу формируем движения по регистрам
//
// Параметры: 
//  ВыборкаПоРаботникиОрганизации 	- выборка из результата запроса по табличной части документа,
//
// Возвращаемое значение:
//  Нет.
//
Процедура ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоСтрокамДокумента)

	Если ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.НеИзменять Тогда
		Возврат;
	КонецЕсли;
	
	Если ВыборкаПоСтрокамДокумента.ТипТаблицы = "Начисление" Тогда
		Движение = Движения.ПлановыеНачисленияРаботников.Добавить();
		
	Иначе
		Движение = Движения.ПлановыеУдержанияРаботников.Добавить();
		
	КонецЕсли;
	
	// Свойства
	Движение.Период						= ВыборкаПоСтрокамДокумента.ДатаДействия;

	// Измерения
	Движение.ФизЛицо					= ВыборкаПоСтрокамДокумента.Физлицо;
	
	// для основного начисления измерение ВидРасчетаИзмерение остается пустым - нельзя ввести 
	// более одного основных видов расчета
	
	Если Не ВыборкаПоСтрокамДокумента.ОсновноеНачисление Тогда
		Движение.ВидРасчетаИзмерение	= ВыборкаПоСтрокамДокумента.ВидРасчета;
	КонецЕсли;
	
	// Ресурсы
	Движение.Действие					= ВыборкаПоСтрокамДокумента.Действие;
	Движение.ВидРасчета					= ВыборкаПоСтрокамДокумента.ВидРасчета;
	Если ВыборкаПоСтрокамДокумента.Действие <> Перечисления.ВидыДействияСНачислением.Прекратить Тогда
		Движение.Действует				= Истина;
		
		// указываем значения показателей, валюту и тарифные разряды
		Для Сч = 1 По 6 Цикл
			Если ВыборкаПоСтрокамДокумента.ПроизвольнаяФормулаРасчета Тогда
				Если Сч <= ВыборкаПоСтрокамДокумента.КоличествоПоказателей Тогда
					Если ВыборкаПоСтрокамДокумента["Показатель" + Сч + "ЗапрашиватьПриКадровыхПеремещениях"]
						Или ВыборкаПоСтрокамДокумента["ОсновноеНачисление"] И ВыборкаПоСтрокамДокумента["Показатель" + Сч + "ТарифнаяСтавка"] Тогда
						Движение["Показатель"+Сч]			= ВыборкаПоСтрокамДокумента["Показатель"+Сч];
						Движение["Валюта"+Сч]				= ВыборкаПоСтрокамДокумента["Валюта"+Сч];
						Если ВыборкаПоСтрокамДокумента.ТипТаблицы = "Начисление" Тогда
							Движение["ТарифныйРазряд"+Сч]		= ВыборкаПоСтрокамДокумента["ТарифныйРазряд"+Сч];
						КонецЕсли;
					Иначе
						Движение["Показатель"+Сч]			= 0;
						Движение["Валюта"+Сч]				= Справочники.Валюты.ПустаяСсылка();
						Если ВыборкаПоСтрокамДокумента.ТипТаблицы = "Начисление" Тогда
							Движение["ТарифныйРазряд"+Сч]		= Справочники.ТарифныеРазряды.ПустаяСсылка();
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
			Иначе
				Движение["Показатель"+Сч]			= ВыборкаПоСтрокамДокумента["Показатель"+Сч];
				Движение["Валюта"+Сч]				= ВыборкаПоСтрокамДокумента["Валюта"+Сч];
				Если ВыборкаПоСтрокамДокумента.ТипТаблицы = "Начисление" Тогда
					Движение["ТарифныйРазряд"+Сч]		= ВыборкаПоСтрокамДокумента["ТарифныйРазряд"+Сч];
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
	
		
	КонецЕсли;
	
	// Движения на дату завершения
	Если ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.Начать 
		И ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаДействияКонец) Тогда
	
		Движение.ДействиеЗавершения		= Перечисления.ВидыДействияСНачислением.Прекратить;
		Движение.ПериодЗавершения		= ВыборкаПоСтрокамДокумента.ДатаДействияКонец + мДлинаСуток;
	
	КонецЕсли;
	
КонецПроцедуры // ДобавитьСтрокуВДвиженияПоРегистрамСведений

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаПроведения(Отказ, Режим)
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	
	// получим реквизиты табличной части Начисления
	ВыборкаПоСтрокамДокумента = СформироватьЗапрос().Выбрать();

	Пока ВыборкаПоСтрокамДокумента.Следующий() Цикл 

		// проверим очередную строку табличной части
		ПроверитьЗаполнениеСтроки(ВыборкаПоСтрокамДокумента, Отказ, Заголовок);

		Если НЕ Отказ Тогда
			// Заполним записи в наборах записей регистров
			ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоСтрокамДокумента);
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	КраткийСоставДокумента =	ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(Начисления, Удержания, "Физлицо");
	
КонецПроцедуры

мСписокНедоступныхРасчетов = Новый СписокЗначений;
мСписокНедоступныхРасчетов.Добавить(ПланыВидовРасчета.УправленческиеУдержания.УдержаноПоБухгалтерии);
мСписокНедоступныхРасчетов.Добавить(ПланыВидовРасчета.УправленческиеНачисления.НачисленоПоБухгалтерии);
мСписокНедоступныхРасчетов.Добавить(ПланыВидовРасчета.УправленческиеНачисления.НачисленоПоБухгалтерииСдельно);

мДлинаСуток = 86400;
