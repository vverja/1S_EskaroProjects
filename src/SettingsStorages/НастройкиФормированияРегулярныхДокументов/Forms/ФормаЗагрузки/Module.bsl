&НаКлиенте
Процедура ЗагрузитьВыполнить()
	
	Если Элементы.СписокНастроек.ТекущаяСтрока <> Неопределено Тогда 
		
		КлючТекущегоВарианта = Элементы.СписокНастроек.ТекущиеДанные.КлючВариантаОтчета;
		
		Закрыть(Новый ВыборНастроек(КлючТекущегоВарианта));
		
	Иначе
		
		Закрыть();
		
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	КлючОбъекта               = Параметры.КлючОбъекта;
	КлючТекущихНастроек       = Параметры.КлючТекущихНастроек;             
		
	Если НЕ ЗначениеЗаполнено(ТекущийПользователь) тогда
		ТекущийПользователь           = ПараметрыСеанса.ТекущийПользователь;
		Параметры.ТекущийПользователь = ТекущийПользователь;
	КонецЕсли;
	
	ЗаполнитьСписокНастроек();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокНастроек(КлючВарианта = Неопределено)
	
	НастройкиФормированияРеглДокументов = РеквизитФормыВЗначение("СписокНастроек");
	НастройкиФормированияРеглДокументов.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	НастройкиФормированияРеглДокументов.Наименование,
	|	НастройкиФормированияРеглДокументов.Ссылка
	|ИЗ
	|	Справочник.НастройкиФормированияДокументовПоОрдерам КАК НастройкиФормированияРеглДокументов
	|ГДЕ
	|	(НЕ НастройкиФормированияРеглДокументов.ПометкаУдаления)
	|	И (НЕ НастройкиФормированияРеглДокументов.ЭтоГруппа)";

	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();

	Пока Выборка.Следующий() Цикл
		СтрокаСписка = НастройкиФормированияРеглДокументов.Добавить();
		СтрокаСписка.Наименование       = Выборка.Наименование;
		СтрокаСписка.КлючВариантаОтчета = Строка(Выборка.Ссылка.УникальныйИдентификатор());
		СтрокаСписка.Ссылка             = Выборка.Ссылка;
	КонецЦикла;
	
	ЗначениеВРеквизитФормы(НастройкиФормированияРеглДокументов, "СписокНастроек");
	
КонецПроцедуры

&НаКлиенте
Процедура СписокНастроекВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ЗагрузитьВыполнить();
КонецПроцедуры

&НаКлиенте
Процедура СписокНастроекПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	Если НЕ ОтменаРедактирования тогда
		Если Элементы.СписокНастроек.ТекущиеДанные <> Неопределено тогда
			ИзменитьНазваниеОбъекта(Элементы.СписокНастроек.ТекущиеДанные.Ссылка, Элемент.ТекущиеДанные.Наименование);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ИзменитьНазваниеОбъекта(Ссылка, Наименование)
	
	Объект = Ссылка.ПолучитьОбъект();
	Объект.Заблокировать();
	Объект.Наименование = Наименование;
	Объект.Записать();
	
Конецпроцедуры